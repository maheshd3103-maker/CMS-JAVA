<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard - CMS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .sidebar-header {
            padding: 20px;
            font-size: 22px;
            font-weight: bold;
            border-bottom: 1px solid #34495e;
            cursor: pointer;
            transition: 0.3s;
        }
        .sidebar-header:hover {
            background: #34495e;
        }
        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: 0.3s;
        }
        .nav-item:hover {
            background: #34495e;
        }
        .nav-item.active {
            background: #34495e;
            border-left: 4px solid white;
        }
        .logout {
            padding: 15px 20px;
            background: #e74c3c;
            cursor: pointer;
            text-align: center;
            transition: 0.3s;
        }
        .logout:hover {
            background: #c0392b;
        }
        .main-content {
            flex: 1;
            background: #ecf0f1;
            padding: 40px;
            overflow-y: auto;
        }
        .header {
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .header p {
            color: #7f8c8d;
        }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-number {
            font-size: 48px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .stat-label {
            font-size: 18px;
            color: #7f8c8d;
        }
        .stat-card.active {
            border-left: 5px solid #f39c12;
        }
        .stat-card.closed {
            border-left: 5px solid #27ae60;
        }
        .stat-card.pending {
            border-left: 5px solid #f39c12;
        }
        .stat-card.progress {
            border-left: 5px solid #3498db;
        }
        .stat-card.users {
            border-left: 5px solid #9b59b6;
        }
        .analytics-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .analytics-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 10px;
        }
        .chart-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
        }
        .chart-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .chart-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bar-label {
            width: 100px;
            font-size: 14px;
            color: #555;
        }
        .bar {
            height: 30px;
            background: #3498db;
            border-radius: 5px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            color: white;
            font-weight: bold;
        }
        .bar.billing { background: #e74c3c; }
        .bar.service { background: #3498db; }
        .bar.technical { background: #f39c12; }
        .bar.account { background: #9b59b6; }
        .bar.other { background: #95a5a6; }
        .line-graph {
            position: relative;
            height: 250px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
        }
        .graph-line {
            position: absolute;
            bottom: 40px;
            left: 40px;
            right: 20px;
            height: 180px;
            border-left: 2px solid #2c3e50;
            border-bottom: 2px solid #2c3e50;
        }
        .data-point {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #27ae60;
            border-radius: 50%;
            cursor: pointer;
        }
        .data-point:hover {
            width: 14px;
            height: 14px;
            background: #229954;
        }
        .graph-label {
            position: absolute;
            font-size: 12px;
            color: #555;
        }
        .y-axis-label {
            left: 5px;
            transform: rotate(-90deg);
            transform-origin: left;
        }
        .x-axis-label {
            bottom: 5px;
        }
        .line-path {
            stroke: #27ae60;
            stroke-width: 2;
            fill: none;
        }
        .avg-time {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div>
            <div class="sidebar-header" onclick="window.location.href='/manager/dashboard'">Manager Dashboard</div>
            <div class="nav-menu">
                <div class="nav-item" th:onclick="'window.location.href=\'' + @{/manager/users} + '\''">All Users</div>
                <div class="nav-item" th:onclick="'window.location.href=\'' + @{/complaint/active} + '\''">Active Complaints</div>
                <div class="nav-item" th:onclick="'window.location.href=\'' + @{/complaint/history} + '\''">Complaint History</div>
            </div>
        </div>
        <div class="logout" th:onclick="'window.location.href=\'' + @{/} + '\''">Logout</div>
    </div>
    <div class="main-content">
        <div class="header">
            <h1>Welcome, Manager!</h1>
            <p>Monitor and manage all complaints from your central dashboard</p>
        </div>
        <div class="stats-container">
            <div class="stat-card active">
                <div class="stat-number" th:text="${activeCount}">0</div>
                <div class="stat-label">Active Complaints</div>
            </div>
            <div class="stat-card closed">
                <div class="stat-number" th:text="${closedCount}">0</div>
                <div class="stat-label">Closed Complaints</div>
            </div>
            <div class="stat-card users">
                <div class="stat-number" th:text="${totalUsers}">0</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card pending">
                <div class="stat-number" th:text="${pendingCount}">0</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card progress">
                <div class="stat-number" th:text="${inProgressCount}">0</div>
                <div class="stat-label">In Progress</div>
            </div>
            <div class="stat-card closed">
                <div class="stat-number" th:text="${closedCount}">0</div>
                <div class="stat-label">Resolved</div>
            </div>
        </div>
        
        <div class="analytics-section">
            <h2>ðŸ“Š Analytics & Reports</h2>
            <div class="chart-box">
                <div class="chart-title">Complaints by Type</div>
                <div class="bar-chart">
                    <div class="bar-item">
                        <div class="bar-label">Billing</div>
                        <div class="bar billing" th:style="'width: ' + ${billingCount * 50} + 'px'" th:text="${billingCount}">0</div>
                    </div>
                    <div class="bar-item">
                        <div class="bar-label">Service</div>
                        <div class="bar service" th:style="'width: ' + ${serviceCount * 50} + 'px'" th:text="${serviceCount}">0</div>
                    </div>
                    <div class="bar-item">
                        <div class="bar-label">Technical</div>
                        <div class="bar technical" th:style="'width: ' + ${technicalCount * 50} + 'px'" th:text="${technicalCount}">0</div>
                    </div>
                    <div class="bar-item">
                        <div class="bar-label">Account</div>
                        <div class="bar account" th:style="'width: ' + ${accountCount * 50} + 'px'" th:text="${accountCount}">0</div>
                    </div>
                    <div class="bar-item">
                        <div class="bar-label">Other</div>
                        <div class="bar other" th:style="'width: ' + ${otherCount * 50} + 'px'" th:text="${otherCount}">0</div>
                    </div>
                </div>
            </div>
            
            <div class="chart-box" style="margin-top: 30px;">
                <div class="chart-title">Status Distribution</div>
                <div class="bar-chart">
                    <div class="bar-item">
                        <div class="bar-label">Pending</div>
                        <div class="bar pending" th:style="'width: ' + (${pendingCount} > 0 ? ${pendingCount * 50} : 20) + 'px; background: #f39c12;'" th:text="${pendingCount}">0</div>
                    </div>
                    <div class="bar-item">
                        <div class="bar-label">In Progress</div>
                        <div class="bar progress" th:style="'width: ' + (${inProgressCount} > 0 ? ${inProgressCount * 50} : 20) + 'px; background: #3498db;'" th:text="${inProgressCount}">0</div>
                    </div>
                    <div class="bar-item">
                        <div class="bar-label">Resolved</div>
                        <div class="bar resolved" th:style="'width: ' + (${closedCount} > 0 ? ${closedCount * 50} : 20) + 'px; background: #27ae60;'" th:text="${closedCount}">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="analytics-section">
            <h2>ðŸ“ˆ Resolution Timeline</h2>
            <div class="chart-box">
                <div class="chart-title">Complaints Resolved Over Time (Last 7 Days)</div>
                <div class="line-graph">
                    <svg width="100%" height="180" style="position: absolute; left: 40px; bottom: 40px; right: 20px;">
                        <polyline class="line-path" th:points="${timelinePoints}"/>
                    </svg>
                    <div class="graph-label y-axis-label" style="top: 80px;">Complaints Resolved</div>
                    <div class="graph-label x-axis-label" style="left: 45%; bottom: 10px;">Days</div>
                    <div th:each="point, stat : ${timelineData}" 
                         class="data-point" 
                         th:style="'left: ' + ${40 + stat.index * 80} + 'px; bottom: ' + ${40 + point.count * 30} + 'px'"
                         th:title="'Day ' + ${stat.index + 1} + ': ' + ${point.count} + ' resolved'"></div>
                </div>
                <div class="avg-time">
                    Average Resolution Time: <span th:text="${avgResolutionTime}">2.5</span> days
                </div>
            </div>
        </div>
    </div>
</body>
</html>
